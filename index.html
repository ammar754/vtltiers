<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Leaderboard — MCTiers-like</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="brand">
        <div class="logo">MT</div>
        <div class="title">
          <h1>Leaderboard</h1>
          <div class="sub small">Public leaderboard — names hidden</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn" onclick="location.reload()">Refresh</button>
        <a href="admin.html" class="btn primary">Admin</a>
      </div>
    </header>

    <div class="layout">
      <main class="card">
        <div class="tabs" id="tabs"></div>
        <div class="topbar">
          <div class="search"><input id="search" placeholder="Search tier, points, or id" /></div>
          <div class="small">Sort: Points ↓</div>
        </div>

        <div class="row header">
          <div>#</div><div>Player</div><div>Region</div><div>Tier</div><div style="text-align:right">Points</div>
        </div>

        <div id="list" class="list"></div>
      </main>

      <aside class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <div><strong>About</strong><div class="small">Static public view</div></div>
        </div>
        <div class="small">To manage players, use Admin panel (server required).</div>
      </aside>
    </div>
  </div>

<script>
const CATEGORIES = ["Overall","LTMs","Vanilla","UHC","Pot","NethOP","SMP","Sword","Axe","Mace"];
let active = 'Overall';

async function init(){
  const tabs = document.getElementById('tabs');
  CATEGORIES.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'tab' + (c===active ? ' active' : '');
    b.textContent = c;
    b.onclick = ()=>{ active=c; render(); document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.textContent===active)); };
    tabs.appendChild(b);
  });
  document.getElementById('search').addEventListener('input', render);
  await render();
}

async function fetchPlayers(){
  try{
    const r = await fetch('/players');
    if(r.ok) return await r.json();
  }catch(e){ console.warn('fetch players failed',e); }
  return [];
}

function maskName(name,id){ return 'Player • ' + (id? id.slice(-4) : Math.random().toString(36).slice(2,6)); }
function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

async function render(){
  const root = document.getElementById('list');
  root.innerHTML = '';
  const all = await fetchPlayers();
  const q = (document.getElementById('search').value || '').trim().toLowerCase();
  let items = all.slice();
  if(active !== 'Overall') items = items.filter(x=> x.region === active || x.mode === active || (x.mode===undefined && x.region===active));
  if(q){
    items = items.filter(it=> (it.tier && it.tier.toLowerCase().includes(q)) || (String(it.points).includes(q)) || (it.id && it.id.toLowerCase().includes(q)));
  }
  items.sort((a,b)=> b.points - a.points);
  items.forEach((row, idx)=>{
    const div = document.createElement('div');
    div.className = 'item cardlike';
    const rank = '<div class="rank">'+(idx+1)+'</div>';
    const avatar = '<div class="avatar"><svg width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="4" fill="rgba(255,255,255,0.02)"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-size="11" font-family="Inter" fill="#9fb0c4">MC</text></svg></div>';
    const player = '<div style="display:flex;gap:12px;align-items:center"><div style="width:72px;height:72px">'+avatar+'</div><div class="meta"><div class="name">'+escapeHtml(maskName(row.name,row.id))+'</div><div class="sub small">'+escapeHtml(row.region || row.mode || '')+'</div></div></div>';
    const tier = '<div class="tier"><span class="badge '+((row.tier||'').toLowerCase())+'">'+escapeHtml(row.tier||'')+'</span></div>';
    const pts = '<div class="pts" style="text-align:right">'+Number(row.points||0).toLocaleString()+'</div>';
    div.innerHTML = rank + player + '<div>'+(escapeHtml(row.region||''))+'</div>' + tier + pts;
    root.appendChild(div);
  });
}

init();
</script>
</body>
</html>
